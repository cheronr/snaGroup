---
title: "R Notebook"
output: html_notebook
---
```{r}
install.packages("igraph")
install.packages("tidygraph")
install.packages("ggraph")
install.packages("readxl")
library(tibble)
library(readxl)
library(igraph)
library(tidygraph)
library(ggraph)

install.packages("ggplot")
library(ggplot2)
install.packages("igraphdata")
library(igraphdata)
install.packages("sna")
library(sna)
install.packages("statnet")
library(statnet)
install.packages("intergraph")
library(intergraph)
install.packages("grid")
library(grid)
install.packages("gridExtra")
library(gridExtra)
install.packages("xtable")
library(xtable)
install.packages("kableExtra")
library(kableExtra)
install.packages("zoo")
library(zoo)
install.packages("intergraph")
library(intergraph)
getwd()

# Import the Excel spread sheet showing each country in africa and the trade zones the are a member of.
countryZone <- groupData11
str(countryZone)

#COnverting first column to the rownames, of the data frame.
countryZone <- as.data.frame(countryZone)
countryZone
countryZone1 <- countryZone[1:17]
row.names(countryZone1) <- countryZone$Country
countryZone1
countryZone1 <- countryZone1[,-1]
countryZone1


#Plots the graph incidence, showing circles as countrys and triangles as trade zones
as_tbl_graph(graph.incidence(countryZone1)) %>% 
  ggraph()+
  geom_node_point(aes(shape = type, size = 18), show.legend = F)+
  geom_node_text(aes(label = name ), colour = 'black', vjust = 2)+
  geom_edge_link()+
  theme_graph()

#Specifying Trade zones as the nodes.
CountryZone_project<- bipartite.projection(graph.incidence(countryZone1)) 
CountryZone_project


projection2 <- as_tbl_graph(CountryZone_project$proj2) %>% 
  ggraph()+
  geom_node_point(aes(size = 20), show.legend = F)+
  geom_node_text(aes(label = name), colour = 'black', vjust = 2)+
  geom_edge_link()+
  theme_graph()
projection2


#Specifying countries as nodes.
CountryZone_project<- bipartite.projection(graph.incidence(countryZone1)) 
CountryZone_project


 projection1 <- as_tbl_graph(CountryZone_project$proj1) %>% 
  ggraph()+
  geom_node_point(aes(size = 20), show.legend = F)+
  geom_node_text(aes(label = name), colour = 'black', vjust = 2)+
  geom_edge_link()+
  theme_graph()
 projection1

```

```{r}

install.packages("keyplayer")
library(keyplayer)
library(ggplot2)
library(ggraph)
library(tibble)
library(readxl)
library(igraph)
library(tidygraph)
library(tidyverse)

#Projection 1: where the nodes are represented by each contry and data is extracted (GLIs)
proj1 <- as_tbl_graph(CountryZone_project$proj1)
class(proj1)
GLI_proj1 <- as_tbl_graph(proj1) %>% 
  mutate(nodes = graph_order(),
         edges = graph_size(), 
         density = edges/((nodes*(nodes-1))), 
         dist = graph_mean_dist(), 
         radius = graph_radius(), 
         diameter = graph_diameter(), 
          components = graph_component_count(),
          directed = graph_is_directed(),
          bipartite = graph_is_bipartite()
         )
GLI_proj1

#Projection 2: where the nodes are represented by each trade zone and data is extracted (GLIs)
proj2 <- as_tbl_graph(CountryZone_project$proj2)
class(proj2)
GLI_proj2 <- as_tbl_graph(proj2) %>% 
  mutate(nodes = graph_order(),
         edges = graph_size(), 
         density = edges/((nodes*(nodes-1))), 
         dist = graph_mean_dist(), 
         radius = graph_radius(), 
         diameter = graph_diameter(), 
          components = graph_component_count(),
          directed = graph_is_directed(),
          bipartite = graph_is_bipartite(), 
         fragment = c(fragment(as_adjacency_matrix(proj2)))
         )
GLI_proj2


#Removed the African Union, from projection 2 to compare any changes between projection 2 (Trade Zone with African union) and projection with out the african union. 

#Removing the african union node from the graph.
g2 <- delete_vertices(proj2, 1) 
g2
V(g2)

#Creating a new graph without the African Union.
projection_UN <- as_tbl_graph(g2)
class(projection_UN)

projection_no_union <- as_tbl_graph(projection_UN) %>% 
  ggraph()+
  geom_node_point(aes(size = 20), show.legend = F)+
  geom_node_text(aes(label = name), colour = 'black', vjust = 2)+
  geom_edge_link()+
  theme_graph()
projection_no_union 

#Modified version of projection 2, where the nodes are represented by each trade zone (Excluding the African union) and data is extracted (GLIs)
GLI_proj_NU <- as_tbl_graph(projection_UN) %>% 
  mutate(nodes = graph_order(),
         edges = graph_size(), 
         density = edges/((nodes*(nodes-1))), 
         dist = graph_mean_dist(), 
         radius = graph_radius(), 
         diameter = graph_diameter(), 
          components = graph_component_count(),
          directed = graph_is_directed(),
          bipartite = graph_is_bipartite(), 
         fragment = c(fragment(as_adjacency_matrix(projection_UN)))
         )
GLI_proj_NU
```


```{r}

#Node level analysis for all zones 
NodeLevel_proj2 <- as_tbl_graph(CountryZone_project$proj2)
NodeLevel_proj2 <- as_tbl_graph(projection2) %>% 
        mutate(degree = degree(asNetwork(NodeLevel_proj2)),
        betweenness_centrality = betweenness(asNetwork(NodeLevel_proj2)),
        closenss_centrality = closeness(asNetwork(NodeLevel_proj2)),
        transitivity = transitivity(NodeLevel_proj2, type = "local")
        )


NodeLevel_proj2


E(projection2)$Distance <- as.numeric(E(projection2)$weight)
as_tbl_graph(projection2) %>% 
  activate(edges) %>% 
  #filter(weight>median(Distance)) %>%
  activate(nodes) %>% 
  mutate(centrality = centrality_closeness(weights = weight)) %>% 
  ggraph(layout = 'auto') + 
  geom_edge_link2(aes(alpha = Distance), colour = "grey") + 
  scale_edge_alpha(aes(alpha = Distance),range = c(0, 1)) +
  geom_node_point(aes(size = centrality, colour = centrality)) + 
  geom_node_text(aes(label = name), colour = 'black', vjust = 0.4) +
  scale_color_continuous(name = "Closeness Centrality",guide = 'legend') + 
  scale_size_continuous(name = "Closeness Centrality",guide = 'legend') +
  theme_graph(base_family = "iA Writer Duospace", title_family = "SF Compact Display", background = "aliceblue", base_size = 8)+ 
  theme(legend.position="right")


#Node level analysis without the Africa

#Removing the african union node from the graph.
remove_AUnion <- delete_vertices(proj2, 1) 
remove_AUnion
V(remove_AUnion)

#Creating a new graph without the African Union.
projection_UN <- as_tbl_graph(remove_AUnion)
class(projection_UN)

NodeLevel_proj2_NU <- as_tbl_graph(projection_UN)
NodeLevel_proj2_NU <- as_tbl_graph(projection_UN) %>% 
        mutate(degree = degree(asNetwork(NodeLevel_proj2_NU)),
        betweenness_centrality = betweenness(asNetwork(NodeLevel_proj2_NU)),
        closenss_centrality = closeness(asNetwork(NodeLevel_proj2_NU)),
        #transitivity = transitivity(NodeLevel_proj2, type = "local")
        )

NodeLevel_proj2_NU


E(projection_UN)$Distance <- as.numeric(E(projection_UN)$weight)
as_tbl_graph(projection_UN) %>% 
  activate(edges) %>% 
  #filter(weight>median(Distance)) %>%
  activate(nodes) %>% 
  mutate(centrality = centrality_closeness(weights = weight)) %>% 
  ggraph(layout = 'auto') + 
  geom_edge_link2(aes(alpha = Distance), colour = "grey") + 
  scale_edge_alpha(aes(alpha = Distance),range = c(0, 1)) +
  geom_node_point(aes(size = centrality, colour = centrality)) + 
  geom_node_text(aes(label = name), colour = 'black', vjust = 0.4) +
  scale_color_continuous(name = "Closeness Centrality",guide = 'legend') + 
  scale_size_continuous(name = "Closeness Centrality",guide = 'legend') +
  theme_graph(base_family = "iA Writer Duospace", title_family = "SF Compact Display", background = "aliceblue", base_size = 8)+ 
  theme(legend.position="right")


print(as.data.frame(NodeLevel_proj2))
print(as.data.frame(NodeLevel_proj2_NU))
```

```{r}


```